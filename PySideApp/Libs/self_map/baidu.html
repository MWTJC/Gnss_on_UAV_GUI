<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<script type="text/javascript" src="//api.map.baidu.com/api?type=webgl&v=1.0&ak=XzNEDkDxkFd2UIH3rBkWXlD0z3gwPonE"></script>
    <script type="text/javascript" src="//mapopen.cdn.bcebos.com/github/BMapGLLib/DistanceTool/src/DistanceTool.min.js"></script>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <title>地图</title>
    <style type="text/css">
        body, html, #container {width: 100%; height: 100%; overflow: hidden; margin: 0; font-family: "微软雅黑";}
        ul li {list-style: none;}
        .info {
            z-index: 999;
            width: auto;
            min-width: 22rem;
            padding: .75rem 1.25rem;
            margin-left: 1.25rem;
            position: fixed;
            top: 1rem;
            background-color: #fff;
            border-radius: .25rem;
            font-size: 14px;
            color: #666;
            box-shadow: 0 2px 6px 0 rgba(27, 142, 236, 0.5);
        }
        .drawing-panel {
            z-index: 999;
            position: fixed;
            bottom: 3.5rem;
            margin-left: 3rem;
            padding: 1rem 1rem;
            border-radius: .25rem;
            background-color: #fff;
            box-shadow: 0 2px 6px 0 rgba(27, 142, 236, 0.5);
        }
        .draw-btn {
            width: 75px;
            height: 30px;
            background-color: #fff;
            color: rgba(27, 142, 236, 1);
            border:1px solid rgba(27, 142, 236, 1);
            border-radius: 5px;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <ul class = "drawing-panel">
        <input type="button" class="draw-btn" value="开启测距" onclick="myDis.open()">
        <input type="button" class="draw-btn" value="关闭测距" onclick="myDis.close()">
    </ul>
    <div id = "container"></div>
</body>
</html>
<script type="text/javascript">
    var map = new BMapGL.Map("container", {enableMapClick:false}); // 创建Map实例,GL版命名空间为BMapGL(鼠标右键控制倾斜角度)
    var convertor = new BMapGL.Convertor();
    var sourcePoint = new BMapGL.Point(106.52285, 29.80708);
    var points = [sourcePoint];
    // 调用转换接口进行坐标转换
    convertor.translate(points, COORDINATES_WGS84, COORDINATES_BD09, function(data) {
        if(data.status === 0) {
            // 转换成功，使用转换后的坐标
            var convertedPoint = data.points[0];
            // 设置地图中心点
            map.centerAndZoom(convertedPoint, 15);
            
            // 可以选择在转换后的位置添加标记
            var marker = new BMapGL.Marker(convertedPoint);
            map.addOverlay(marker);
        }
    });
	// map.centerAndZoom(new BMapGL.Point(106.52285, 29.80708), 5);     // 初始化地图,设置中心点坐标和地图级别
    var myDis = new BMapGLLib.DistanceTool(map);
    map.addControl(new BMapGL.MapTypeControl({   //添加地图类型控件
        // 控件的停靠位置（可选，默认左上角）
        anchor: BMAP_ANCHOR_TOP_LEFT,
        // 控件基于停靠位置的偏移量（可选）
        offset: new BMapGL.Size(20, 20)
    }));         

        map.enableScrollWheelZoom(); // 启用滚轮放大缩小
        
        var scaleCtrl = new BMapGL.ScaleControl();  // 添加比例尺控件
        map.addControl(scaleCtrl);
        var zoomCtrl = new BMapGL.ZoomControl({   // 添加缩放控件
        }); 
        map.addControl(zoomCtrl);
        var navi3DCtrl = new BMapGL.NavigationControl3D({   // 添加3D控件
            offset: new BMapGL.Size(15, 80)
        }); 
        map.addControl(navi3DCtrl);

        // 创建定位控件
        var locationControl = new BMapGL.LocationControl({
            // 控件的停靠位置（可选，默认左上角）
            anchor: BMAP_ANCHOR_TOP_RIGHT,
            // 控件基于停靠位置的偏移量（可选）
            offset: new BMapGL.Size(20, 20)
        });
        // 将控件添加到地图上
        map.addControl(locationControl);

        // 添加定位事件
        locationControl.addEventListener("locationSuccess", function(e){
            alert(e.message);
        });
        locationControl.addEventListener("locationError",function(e){
            alert(e.message);
        });


    // 监听测距过程中的鼠标事件
    myDis.addEventListener('drawend', function(e) {
        console.log("drawend");
        console.log(e.points);
        console.log(e.overlays);
	    console.log(e.distance);
    });
    myDis.addEventListener("addpoint", function(e) {
        console.log("addpoint");
        console.log(e.point);
        console.log(e.pixel);
        console.log(e.index);
        console.log(e.distance);
    });
    myDis.addEventListener("removepolyline", function(e) {
        console.log("removepolyline");
        console.log(e);
    });

    // qwebchannel相关
    var channel = null;
        new QWebChannel(qt.webChannelTransport, function(ch) {
            channel = ch;
        });
        
        // 定义可以被Python调用的函数
        function openDistance() {
            myDis.open();
        }
        
        function closeDistance() {
            myDis.close(); 
        }
    
</script>
